{% extends "govuk-prototype-kit/layouts/govuk-branded.njk" %}
{% from "govuk/components/service-navigation/macro.njk" import govukServiceNavigation %}

{% block beforeContent %}
  {{ govukPhaseBanner({
    tag: { text: "Training" },
    html: 'This is not a real service ‚Äì this is for training purposes only. You can <a class="govuk-link" href="mailto:lorithomson@hotmail.co.uk">give your feedback on this resource by email</a> or <a href="https://www.surveymonkey.com/r/8JZX5KD" class="govuk-link" target="_blank" rel="noopener noreferrer"> feedback survey (opens in a new tab)</a>.'
  }) }}
{% endblock %}

{% block head %}
  {{ super() }}

  <link rel="icon" href="" type="image/x-icon">
  <link rel="shortcut icon" href="" type="image/x-icon">

  <link
    rel="icon"
    type="image/svg+xml"
    href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üéÖ</text></svg>'
  >
{% endblock %}

{% block header %}
<header class="govuk-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-width-container header-with-toggle">

    <!-- Logo -->
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <img
          src="{{ asset_path }}images/DEA_logo_full.png"
          alt="Department for Elfish Affairs"
          class="santa-logo"
        >
      </a>
    </div>

    <!-- Service name -->
    {% if serviceName %}
    <div class="govuk-header__content">
      <a href="/" class="govuk-header__link govuk-header__service-name">
        {{ serviceName }}
      </a>
    </div>
    {% endif %}

    <!-- FESTIVE TOGGLE -->
    <button
      id="festive-toggle"
      class="festive-toggle-combo"
      aria-pressed="false"
    >
      <span class="switch-track">
        <span class="switch-knob"></span>
      </span>

      <span class="switch-text">Festive effects</span>

      <!-- Screen reader announcement -->
      <span
        id="festive-toggle-announcement"
        class="govuk-visually-hidden"
        aria-live="polite"
      >
        Festive effects are off
      </span>
    </button>

  </div>
</header>
{% endblock %}

{% block stylesheets %}
  {{ super() }}

<script>
document.addEventListener("DOMContentLoaded", function () {
  const body = document.body;
  const btn = document.getElementById("festive-toggle");
  if (!btn) return;

  const label = btn.querySelector(".switch-text");
  const announcement = document.getElementById("festive-toggle-announcement");

  function updateState(isOn) {
    if (isOn) {
      body.classList.remove("no-festive");
      btn.setAttribute("aria-pressed", "true");
      btn.classList.add("is-on");

      label.textContent = "‚ùÑÔ∏è Festive effects off";

      announcement.textContent =
        "Festive effects on. Festive fairy lights appear across the headers and presents and stockings are displayed on the page.";

      localStorage.setItem("festiveEffects", "on");
    } else {
      body.classList.add("no-festive");
      btn.setAttribute("aria-pressed", "false");
      btn.classList.remove("is-on");

      label.textContent = "üéÑ Festive effects on";

      announcement.textContent =
        "Festive effects off. Decorative animations and festive visuals are hidden.";

      localStorage.setItem("festiveEffects", "off");
    }
  }

  // Restore saved preference
  const pref = localStorage.getItem("festiveEffects");
  updateState(pref !== "off");

  // Toggle on click
  btn.addEventListener("click", function (event) {
    event.stopPropagation();
    const isOn = btn.getAttribute("aria-pressed") === "true";
    updateState(!isOn);
  });
});
</script>

{% endblock %}

{% block content %}
  <main id="main-content" class="govuk-main-wrapper" role="main">
    <div class="govuk-width-container">

      {% block beforeDayContent %}{% endblock %}

      {{ super() }}

      {% block dayNavigation %}{% endblock %}

    </div>
  </main>
{% endblock %}

{% block footer %}
  {{ govukFooter({
    meta: {
      items: [
        { href: "/manage-prototype/clear-data", text: "Clear data" },
        { href: "/sitemap", text: "Site map" },
        { href: "/accessibility", text: "Accessibility statement" },
        { href: "/advent-calendar/about", text: "About this service" },
        { href: "https://www.surveymonkey.com/r/V9NSS3Z", text: "Feedback survey" },
        { href: "https://github.com/Lori-T/accessibility-advent-2025", text: "GitHub" }
      ],
      visuallyHiddenTitle: "Footer links"
    },
    contentLicence: {
      text: "¬© 2025 Department for Elfish Affairs"
    }
  }) }}
{% endblock %}
