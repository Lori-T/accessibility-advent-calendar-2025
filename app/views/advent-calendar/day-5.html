{% extends "/layouts/main.html" %}

{% set pageTitle = "Day 5: Check keyboard access on the Gift Tracker" %}
{% set currentDayNumber = 5 %}

{% block beforeContent %}
  {{ govukBackLink({
      text: "Back to home",
      href: "/"
  }) }}
{% endblock %}

{% block content %}

<div id="day-content">

<h1 class="govuk-heading-l">Day 5: Check keyboard access on the Gift Tracker</h1>

<p class="govuk-body">
  The <strong>Department of Elfish Affairs</strong> has received a report about the
  <strong>Gift Tracker</strong>, the system elves use to update toy progress and delivery
  status across Santa HQ.
</p>

<p class="govuk-body">
  Several elves have reported that parts of the tracker only work with a mouse.
  This creates barriers for people who rely on keyboards or alternative input devices.
</p>

<h2 class="govuk-heading-m">Your mission today</h2>
<p class="govuk-body">
  Check that all interactive elements can be reached and used with a keyboard.
</p>

<h2 class="govuk-heading-m">Quick 5-minute check</h2>
<ul class="govuk-list govuk-list--bullet">
  <li>use the <kbd>Tab</kbd> key to move through interactive elements</li>
  <li>use <kbd>Shift</kbd> + <kbd>Tab</kbd> to move backwards</li>
  <li>links, buttons and form controls must receive focus</li>
  <li>custom controls must be keyboard operable</li>
</ul>

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

<h2 class="govuk-heading-m">Examine the Gift Tracker</h2>
<p class="govuk-body">
  Below is a simplified section of the Gift Tracker.
  One control has a deliberate keyboard accessibility issue.
</p>

<div class="govuk-!-padding-4 govuk-!-margin-bottom-4"
     style="background:#f7f7f7; border-radius:8px; max-width:640px;">

  <p class="govuk-body">
    <strong>Train set</strong><br>
    Status: In production
  </p>

  <div style="display:flex; gap:16px; flex-wrap:wrap; align-items:flex-start;">

    <!-- GOOD BUTTON -->
    <button
      class="govuk-button"
      type="button"
      id="readyButton"
      onclick="openDialog('ready')">
      ‚úì Mark as ready for Christmas Eve
    </button>

    <!-- BAD CONTROL: MOUSE ONLY -->
    <div
      onclick="openDialog('delayed')"
      style="
        background:#8b0000;
        color:#ffffff;
        padding:10px 16px;
        border:2px solid #5c0000;
        border-radius:4px;
        box-shadow:0 2px 0 #5c0000;
        font-weight:600;
        cursor:pointer;
        user-select:none;
      ">
      ‚úñ Mark as delayed by snow
    </div>

  </div>

  <p class="govuk-body govuk-!-margin-top-3">
    One of these controls can be reached and activated using the keyboard.
    The other cannot.
  </p>

</div>

</div>

<!-- ACCESSIBLE MODAL DIALOG -->
<div id="status-dialog" hidden>
  <div
    role="dialog"
    aria-modal="true"
    aria-labelledby="dialog-title"
    aria-describedby="dialog-description"
    style="
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    "
  >
    <div
      id="dialog-content"
      tabindex="-1"
      style="
        background:#ffffff;
        padding:24px;
        border-radius:8px;
        max-width:420px;
        width:calc(100% - 40px);
      "
    >
      <h2 id="dialog-title" class="govuk-heading-m"></h2>

      <p id="dialog-description" class="govuk-body"></p>

      <button
        class="govuk-button govuk-button--secondary"
        type="button"
        onclick="closeDialog()">
        Close
      </button>
    </div>
  </div>
</div>

<script>
  let lastFocusedElement;

  function openDialog(type) {
    lastFocusedElement = document.activeElement;

    const dialog = document.getElementById('status-dialog');
    const content = document.getElementById('dialog-content');
    const title = document.getElementById('dialog-title');
    const description = document.getElementById('dialog-description');
    const page = document.getElementById('day-content');

    if (type === 'ready') {
      title.textContent = 'Gift ready for Christmas Eve';
      description.textContent =
        'The train set is complete and ready to be loaded onto Santa‚Äôs sleigh üéÑüöÇ';
    }

    if (type === 'delayed') {
      title.textContent = 'Gift delivery delayed';
      description.textContent =
        'Heavy snow has slowed production. Elves are investigating alternative routes ‚ùÑÔ∏èüéÅ';
    }

    dialog.removeAttribute('hidden');
    page.setAttribute('aria-hidden', 'true');
    page.setAttribute('inert', '');
    content.focus();

    document.addEventListener('keydown', trapFocus, true);
  }

  function closeDialog() {
    const dialog = document.getElementById('status-dialog');
    const page = document.getElementById('day-content');

    dialog.setAttribute('hidden', '');
    page.removeAttribute('aria-hidden');
    page.removeAttribute('inert');

    document.removeEventListener('keydown', trapFocus, true);
    if (lastFocusedElement) lastFocusedElement.focus();
  }

  function trapFocus(e) {
    if (e.key !== 'Tab') return;

    const focusable = document
      .getElementById('status-dialog')
      .querySelectorAll('button');

    const first = focusable[0];
    const last = focusable[focusable.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault();
      last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault();
      first.focus();
    }

    if (e.key === 'Escape') closeDialog();
  }
</script>

<h2 class="govuk-heading-m">What this checks for</h2>

 <p class="govuk-body"><a href="https://www.w3.org/WAI/WCAG22/Understanding/keyboard.html" class="govuk-link" target="_blank">2.1.1 keyboard (opens in a new tab)</a></strong> - all functionality must be operable using a keyboard.

<h2 class="govuk-heading-m">Why this matters</h2>
<p class="govuk-body">
  Many users cannot use a mouse. If interactive elements are not keyboard accessible,
  those users are completely blocked from completing tasks.
</p>

<h2 class="govuk-heading-m">
  Finding this issue using the Web Accesibility Viewer for Elves (WAVE)
</h2>

<p class="govuk-body">
  When <a href="https://wave.webaim.org/extension/" class="govuk-link">WAVE</a> is run on a page like this,
  it may highlight elements that look interactive but are not built using semantic HTML.
</p>

<p class="govuk-body">
  WAVE can help point you towards potential issues, but keyboard testing is essential.
  The fastest way to find this problem is to try using the <kbd>Tab</kbd> key yourself.
</p>

<img
  src="{{ asset_path }}images/wave5.png"
  alt="WAVE highlighting a non keyboard accessible control"
  style="width: 25%; border-radius: 8px;">

<h2 class="govuk-heading-m">Bonus challenge</h2>
<p class="govuk-body">
  Try navigating this page using only your keyboard.
  Which control prevents you from completing the task?
</p>

{{ super() }}
{% endblock %}

{% block dayNavigation %}
<div class="govuk-!-margin-top-6 govuk-!-margin-bottom-6">
  <nav class="govuk-body" aria-label="Day navigation">

    {% if currentDayNumber > 1 %}
      <a class="govuk-link govuk-!-margin-right-4"
         href="/advent-calendar/day-{{ currentDayNumber - 1 }}">
        ‚Üê Previous day
      </a>
    {% endif %}

    {% if currentDayNumber < 12 %}
      <a class="govuk-link"
         href="/advent-calendar/day-{{ currentDayNumber + 1 }}">
        Next day ‚Üí
      </a>
    {% endif %}

  </nav>
</div>
{% endblock %}
