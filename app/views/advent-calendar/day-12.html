{% extends "/layouts/main.html" %}

{% set pageTitle = "Day 12: Check ARIA use on the Sleigh Launch Dashboard" %}
{% set currentDayNumber = 12 %}

{% block beforeContent %}
  {{ govukBackLink({
      text: "Back to calendar",
      href: "/"
  }) }}
{% endblock %}

{% block content %}

<div id="day-content">

<h1 class="govuk-heading-l">Day 12: Check ARIA use on the Sleigh Launch Dashboard</h1>

<p class="govuk-body">
  Before Santa takes off, the elves run final checks on the
  <strong>Sleigh Launch Dashboard</strong> ‚Äî fuel levels, reindeer readiness
  and Christmas spirit.
</p>

<p class="govuk-body">
  A developer elf has added ARIA in the wrong places.
  One control looks like a button and is announced like a button,
  but does not behave like one.
</p>

<h2 class="govuk-heading-m">Your mission today</h2>
<p class="govuk-body">
  Identify the control that is not built correctly, even though it looks right.
</p>

<h2 class="govuk-heading-m">Quick 5-minute check</h2>
<ul class="govuk-list govuk-list--bullet">
  <li>use native HTML elements wherever possible</li>
  <li><code>&lt;button&gt;</code> elements work without extra ARIA</li>
  <li>ARIA roles do not add keyboard behaviour</li>
  <li>controls must work with <kbd>Tab</kbd>, <kbd>Enter</kbd> and <kbd>Space</kbd></li>
</ul>

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

<h2 class="govuk-heading-m">Test the Sleigh Launch Dashboard</h2>
<p class="govuk-body">
  One of the controls below is built correctly.
  The other only looks like a button.
</p>

<div class="govuk-!-padding-4 govuk-!-margin-bottom-4"
     style="background:#eef7ff; border-radius:8px; max-width:640px;">

  <h3 class="govuk-heading-s">Pre-launch checks</h3>

  <div style="display:flex; gap:16px; flex-wrap:wrap;">

    <!-- Correct control: native button -->
    <button
      class="govuk-button"
      type="button"
      id="spiritButton"
      onclick="openSpiritDialog()">
      ‚úì Start Christmas spirit check
    </button>

    <!-- Incorrect control: link styled as button with ARIA misuse -->
    <a
      href="#"
      class="govuk-button govuk-button--warning"
      role="button"
      tabindex="-1"
      onclick="openFuelDialog(); return false;">
      ‚úñ Launch fuel scan
    </a>

  </div>

  <p class="govuk-body govuk-!-margin-top-3">
    One of these controls can be reached and activated using a keyboard.
    The other cannot ‚Äî even though it is announced as a button.
  </p>

</div>

</div>

<!-- DIALOG: Christmas spirit check -->
<div id="spirit-dialog" hidden>
  <div
    role="dialog"
    aria-modal="true"
    aria-labelledby="spirit-title"
    aria-describedby="spirit-desc"
    class="dialog-overlay">
    <div class="dialog-content" tabindex="-1">
      <h2 id="spirit-title" class="govuk-heading-m">
        Christmas spirit check running
      </h2>
      <p id="spirit-desc" class="govuk-body">
        Festive levels are high. Reindeer are cheerful and ready for take-off üéÑ‚ú®
      </p>
      <button class="govuk-button govuk-button--secondary" type="button" onclick="closeDialog()">
        Close
      </button>
    </div>
  </div>
</div>

<!-- DIALOG: Fuel scan -->
<div id="fuel-dialog" hidden>
  <div
    role="dialog"
    aria-modal="true"
    aria-labelledby="fuel-title"
    aria-describedby="fuel-desc"
    class="dialog-overlay">
    <div class="dialog-content" tabindex="-1">
      <h2 id="fuel-title" class="govuk-heading-m">
        Fuel scan started
      </h2>
      <p id="fuel-desc" class="govuk-body">
        Fuel reserves are being analysed. Results pending ‚ùÑÔ∏è‚õΩ
      </p>
      <button class="govuk-button govuk-button--secondary" type="button" onclick="closeDialog()">
        Close
      </button>
    </div>
  </div>
</div>

<style>
  .dialog-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .dialog-content {
    background: #ffffff;
    padding: 24px;
    border-radius: 8px;
    max-width: 420px;
    width: calc(100% - 40px);
  }
</style>

<script>
  let lastFocusedElement;

  function openSpiritDialog() {
    openDialog('spirit-dialog');
  }

  function openFuelDialog() {
    openDialog('fuel-dialog');
  }

  function openDialog(id) {
    lastFocusedElement = document.activeElement;

    const page = document.getElementById('day-content');
    const dialog = document.getElementById(id);
    const content = dialog.querySelector('.dialog-content');

    dialog.removeAttribute('hidden');
    page.setAttribute('aria-hidden', 'true');
    page.setAttribute('inert', '');

    content.focus();
    document.addEventListener('keydown', trapFocus, true);
  }

  function closeDialog() {
    const dialogs = document.querySelectorAll('[role="dialog"]');
    const page = document.getElementById('day-content');

    dialogs.forEach(d => d.parentElement.setAttribute('hidden', ''));

    page.removeAttribute('aria-hidden');
    page.removeAttribute('inert');

    document.removeEventListener('keydown', trapFocus, true);
    if (lastFocusedElement) lastFocusedElement.focus();
  }

  function trapFocus(e) {
    if (e.key === 'Escape') closeDialog();
    if (e.key !== 'Tab') return;

    const activeDialog = document.querySelector('[role="dialog"]:not([hidden])');
    if (!activeDialog) return;

    const focusable = activeDialog.querySelectorAll('button');
    const first = focusable[0];
    const last = focusable[focusable.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault();
      last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault();
      first.focus();
    }
  }
</script>

<h2 class="govuk-heading-m">
  Finding this using the Workshop Accessibility Verification Engine (WAVE)
</h2>

<p class="govuk-body">
  When you run
  <a href="https://wave.webaim.org/extension/" class="govuk-link">WAVE</a>
  on this page, it highlights that one element has a
  <code>role="button"</code> but is not a native button.
</p>

<p class="govuk-body">
  WAVE can flag the ARIA misuse, but it cannot confirm whether the control
  actually works with a keyboard. Manual testing is essential.
</p>

<img
  src="{{ asset_path }}images/wave12.png"
  alt="WAVE highlighting an element with role button that is not a native button"
  style="width:40%; border-radius:8px;">

<h2 class="govuk-heading-m">What this checks for</h2>
<p class="govuk-body">
  <strong>4.1.2 name, role, value</strong> ‚Äî interactive components must expose
  the correct role and behaviour to assistive technologies.
</p>

<h2 class="govuk-heading-m">Why this matters</h2>
<p class="govuk-body">
  If something looks like a button but behaves differently, people using
  keyboards or screen readers may be blocked from completing tasks ‚Äî
  even though the interface appears usable.
</p>

<h2 class="govuk-heading-m">Bonus challenge</h2>
<p class="govuk-body">
  Try using only your keyboard.
  Which control works as expected?
</p>

{{ super() }}
{% endblock %}

{% block dayNavigation %}
<div class="govuk-!-margin-top-6 govuk-!-margin-bottom-6">
  <nav class="govuk-body" aria-label="Day navigation">
    <a class="govuk-link govuk-!-margin-right-4"
       href="/advent-calendar/day-11">
      ‚Üê Previous day
    </a>
  </nav>
</div>
{% endblock %}
